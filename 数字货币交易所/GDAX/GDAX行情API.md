# GDAX API #
---

## REST API概述 ##
1. 公共API URL：`https://api.gdax.com`

2. 所有请求的content-type都为**application/json**，响应状态码为常规的HTTP返回码

3. 请求错误：如无特殊说明，错误的请求将返回4XX错误码，body中将包含**message**，作为错误信息

4. 请求成功：返回码为200，并可能包含body，具体视接口而定

	附：错误码解释

	 Status Code					Reason
		400				Bad Request – Invalid request format
		401				Unauthorized – Invalid API Key
		403				Forbidden – You do not have access to the requested resource
		404				Not Found
		500				Internal Server Error – We had a problem with our server

	eg.
	> {"message": "Invalid Price"}

5. 所有返回列表数据的rest接口，都支持游标分页。像/trades, /fills, /orders接口，默认返回最新结果，
   可以根据当前页，向前或向后获取更多结果（这个特性具体怎么用，验证之后再补充）
6. 除非特殊说明，所有时间戳都是[ISO_8601](https://en.wikipedia.org/wiki/ISO_8601 "ISO_8601")时间，精确到微秒级，需要单独处理
7. 为了保证精度不丢失，**所有小数都转换成了相应字符串**。建议发送请求时，也将小数转换成字符串。整数类型不在此范围内
8. 除非特殊说明，**所有ID都是UUID形式的**，如：`132fb6ae-456b-4654-b4e0-d681ac05cea1` 或 `132fb6ae456b4654b4e0d681ac05cea1`
    
9. 访问限制：访问次数超过限制时，将会返回状态 **429 Too Many Requests**

	REST API

	public端（market）：通过IP进行控制，每秒3个请求，突发性请求，每秒最多6个

	private端（订单管理，账户管理）：通过用户ID控制，每秒5个请求，突发性请求，每秒最多10个

	
	实在翻译不下去了，给原文，自己翻译吧~~

	    REST API
    	PUBLIC ENDPOINTS
    	We throttle public endpoints by IP: 3 requests per second, up to 6 requests per second in bursts.
    	
    	PRIVATE ENDPOINTS
    	We throttle private endpoints by user ID: 5 requests per second, up to 10 requests per second in bursts.
    	
    	FINANCIAL INFORMATION EXCHANGE API
    	The FIX API throttles the number of incoming messages to 50 commands per second.
10. 所有private端的请求，都需要API key进行签名认证
11. 通过官网生成自己的APIkey，需要记住**Key，Secret、Passphrase**,这三个东东很重要！
12. 生成APIkey的时候，可以选择权限级别，请谨慎选择
	
	权限级别：
	View-调用所有GET接口  
	Transfer-可以用来转账提现等  
	Trade-交易和查询订单，能访问所有/orders的POST请求，部分GET请求

	原文

	    View - Allows a key read permissions. This includes all GET endpoints.
    	Transfer - Allows a key to transfer currency on behalf of an account, including deposits and withdraws. Enable with caution - API key transfers WILL BYPASS two-factor authentication.
    	Trade - Allows a key to enter orders, as well as retrieve trade data. This includes POST /orders and several GET endpoints.
    
13. 所有private端的请求都需要附带如下header

	**CB-ACCESS-KEY** The api key as a string. 

	**CB-ACCESS-SIGN** The base64-encoded signature (see Signing a Message).

	**CB-ACCESS-TIMESTAMP** A timestamp for your request.

	**CB-ACCESS-PASSPHRASE** The passphrase you specified when creating the API key.
	
	如果有body，**content-type**设置为**application/json**

14. 签名算法：

	    The CB-ACCESS-SIGN header is generated by creating a sha256 HMAC using the base64-decoded secret key on the prehash string timestamp + method + requestPath + body (where + represents string concatenation) and base64-encode the output. The timestamp value is the same as the CB-ACCESS-TIMESTAMP header.
    
    	The body is the request body string or omitted if there is no request body (typically for GET requests).
    
    	The method should be UPPER CASE.
15. 请求header参数中的**CB-ACCESS-TIMESTAMP**字段，是unix时间戳，精确到秒级。该时间戳与API服务器的时间戳相差**不超过30秒**，否则将会认为是超时而被拒绝。因此，在无法确信本地时间与API服务器的时间差时，建议通过[/time](https://docs.gdax.com/?python#time)接口从API服务器查询当前时间

---

## websocket API概述 ##
1. 连接定地址：wss://ws-feed.gdax.com
2. websocket连接是公共可用的（**不会翻译下半段**，原文：The websocket feed is publicly available, but connections to it are rate-limited to 1 per 4 seconds per IP.）
3. 全双工通信模式，以json格式进行传输，每个消息都有**type**字段标识状态
4. **type为error时**，**message字段**中将会包含报错详细信息
5. **订阅**
	1. 开始接收数据前，需要进行响应消息通道的订阅（**subscribe**），告知服务端，我们想要接收哪些通道和交易对的数据，如果未进行订阅，5秒钟之后，socket连接接口自动关闭
	2. 有两种方法订阅需要监听哪些交易对的哪些数据通道，**第一种**，在数据通道里定义交易对，**第二种**，在subscribe顶端，增加交易对列表，详细看下面示例
	3. 订阅成功后，将会返回subscriptions信息，包含你订阅成功的通道信息。假如你多次订阅，随后的订阅信息也将包含在新的subscriptions里
	4. 取消订阅请求，格式与订阅完全一致，另外，如果不传入交易对信息，所有交易对对应该数据通道的订阅请求，都将被取消
	5. 取消订阅请求，也将会返回subscriptions信息
	6. 订阅请求中可以附带权限验证信息，通过验证后，能接收到更多的信息，比如订单变动回报
		
			第一种订阅方式
			{
			    "type": "subscribe",
			    "channels": [
					{
			            "name": "level2",
			            "product_ids": [
			                "ETH-BTC",
			                "ETH-USD"
			            ]
			        }，
					{
			            "name": "heartbeat",
			            "product_ids": [
			                "ETH-BTC",
			                "ETH-USD"
			            ]
			        }，
			        {
			            "name": "ticker",
			            "product_ids": [
			                "ETH-BTC"
			            ]
			        }
			    ]
			}
			
			说明：订阅ETH-BTC和ETH-USD的level2和heartbeat通道，订阅ETH-BTC的ticker通道

	
			第二种订阅方式
		
			{
			    "type": "subscribe",
			    "product_ids": [
			        "ETH-USD",
			        "ETH-EUR"
			    ],
			    "channels": [
			        "level2",
			        "heartbeat",
			        {
			            "name": "ticker",
			            "product_ids": [
			                "ETH-BTC",
			                "ETH-USD"
			            ]
			        }
			    ]
			}

			说明：订阅ETH-USD和ETH-EUR（顶层product_ids元素的值）的level2，heartbeat，ticker通道，
			同时，额外订阅ETH-BTC和ETH-USD的ticker
			
			强烈建议使用第二种订阅方式！！！

===============================================================================================================
## 行情(public market data) ##

### websocket接口 ###

#### 深度行情 ####

当完成订阅之后，将会推送一个**snapshot**消息，此时包含全量的深度行情，之后将收到**l2update**信息，为增量行情，通过l2update行情，更新snapshot全量行情


		推送的数据格式
		snapshot
		{
		    "type": "snapshot",
		    "product_id": "BTC-EUR", # 交易对
		    "bids": [["6500.11", "0.45054140"]], # 买单队列
		    "asks": [["6500.15", "0.57753524"]]  # 卖单队列
		}
		
		l2update
		{
		    "type": "l2update",
		    "product_id": "BTC-EUR",
		    "changes": [
		        ["buy", "6500.09", "0.84702376"],
		        ["sell", "6507.00", "1.88933140"],
		        ["sell", "6505.54", "1.12386524"],
		        ["sell", "6504.38", "0"]
		    ]
		}
		说明：changes里["buy", "6500.09", "0.84702376"]分别指买卖方向，对应于snapshot中的bids和asks，申买/申卖价，剩余量。此处的量，是指市场上的剩余申买申卖量
		
---
### rest接口 ###

#### 查询交易量限制 ####

**GET /products**

	响应消息：
	[
	    {
	        "id": "BTC-USD",	# 交易对
	        "base_currency": "BTC",  # 基础币种
	        "quote_currency": "USD",	# 对标币种
	        "base_min_size": "0.001",	# 最小下单量，此处为BTC的最小量
	        "base_max_size": "10000.00",	# 最大下单量
	        "quote_increment": "0.01"	# 价格递增幅度，即价格精度
	    }
	]
	
	解释：quote_increment字段，举例说明，本示例响应消息中，表示价格下单价格精确到0.01，
	此时，下单价位0.04，1.92等都是合法的，但1.001，0.928等将会被拒绝


#### 市场买卖队列 ####

**GET /products/<product-id>/book**

接口默认返回1档深度行情，通过在查询参数上增加level信息，扩展深度，level取值如下：
	
	level			说明
	1			只返回1档最优深度行情，深度行情中包含[ price, size, num-orders ]
	2			返回50档深度行情，深度行情中包含[ price, size, num-orders ]
	3			返回全量深度行情，深度行情中包含[ price, size, order_id ]

	建议用websocket接口获取深度行情

#### ticker数据获取 ####

**GET /products/<product-id>/ticker**

#### 获取指定交易对最近的成交记录 ####

**GET /products/<product-id>/trades**


#### 币种信息 ####

**GET /currencies**

	响应消息：
	[{
	    "id": "BTC",	# ID，即简写
	    "name": "Bitcoin",	# 币种名称
	    "min_size": "0.00000001"	# 最小量
	}, {
	    "id": "USD",
	    "name": "United States Dollar",
	    "min_size": "0.01000000"
	}]


#### 获取服务器时间 ####

**GET /time**

	响应消息：
	{
	    "iso": "2015-01-07T23:47:25.201Z",	# iso8601格式时间
	    "epoch": 1420674445.201	# unix时间戳
	}


===============================================================================================================
## 交易(trade) ##

### websocket接口 ###

### rest接口 ###

#### 下单 ####
只要资金足够，就能下单，一旦下单，下单部分的资金将被锁定，直到该订单成交或撤销。

**POST /orders**

key级别：trade

请求参数：

	common

	client_id		[可选]客户端订单ID
	type			[可选]价格类型（limit or market 默认limit）
	side			买卖方向（buy or sell）
	product_id		产品ID（即交易对）
	stp				[可选]子交易保护标记
	stop			[可选]loss 或 entry，与stop_price配合使用
	stop_price		[可选]止盈止损单触发价格。只有定义了stop字段，此字段才有意义。

	
	market
	
	size			[可选]BTC买入/卖出量
	funds			[可选]指定币种的买入/卖出量
	注：两者必定传入一个！

	limit

	price			委托价格
	size			委托量
	time_in_force	[可选]订单过期类型（GTC，GTT，IOC，FOK，默认GTC）
	cancel_after	[可选]time_in_force为GTT才有意义，取值：min，hour，day
	post_only		[可选]time_in_force为IOC或FOK时，此字段无意义
	

	疑问：stp默认值是什么？


返回信息说明：

	{
	    "id": "d0c5340b-6d6c-49d9-b567-48c4bfca13d2",
	    "price": "0.10000000", # 委托价格
	    "size": "0.01000000",  # 委托量
	    "product_id": "BTC-USD", # 交易对
	    "side": "buy",	# 买卖方向
	    "stp": "dc",	# 自交易保护标记
	    "type": "limit",	# 价格类型
	    "time_in_force": "GTC",	# 订单过期类型
	    "post_only": false,	
	    "created_at": "2016-12-08T20:02:28.53864Z",	# 订单创建日期
	    "fill_fees": "0.0000000000000000",	# 交易费用
	    "filled_size": "0.00000000",	# 已成交量
	    "executed_value": "0.0000000000000000",	# 交易额
	    "status": "pending",	# 订单状态
	    "settled": false	# 
	}	


#### 撤单 ####

**DELETE /orders/<order-id>**

key级别：trade

	当订单已经成交，或者已经成交，将会返回错误，错误详情从message字段中获取
	响应消息示例：

	｛
		待补充
	｝


#### 批量撤单 ####
**DELETE /orders**

key级别：trade

	请求参数：
	product_id		[可选]待撤销所有订单的交易对

	响应消息示例：
	[
	    "144c6f8e-713f-4682-8435-5280fbe8b2b4",
	    "debe4907-95dc-442f-af3b-cec12f42ebda",
	    "cf7aceee-7b08-4227-a76c-3858144323ab",
	    "dfc5ae27-cadb-4c0c-beef-8994936fde8a",
	    "34fecfbf-de33-4273-b2c6-baf8e8948be4"
	]

*注意：这家交易所的批量撤单与已经实现的几家不太一样！！！*

*这个接口是撤掉所有订单，或者撤指定交易对的订单，其他交易所基本都是指定订单ID进行批量撤单的*


#### 查询批量订单 ####
**GET /orders**

查询所有未成交的订单，已完成的订单将不会查询出来

	请求参数				取值					说明
		
	status		[open, pending, active]		查询指定状态的订单，传入all，将查询所有订单
	product_id				可选				传入product_id时，将查询指定交易对的订单

	查询多种状态的订单，可如下访问：/orders?status=done&status=pending

	注：订单的done状态和settled状态之间，会有一个短暂的延时。当订单完全成交之后，将从交易队列中移除，此时标记为done状态，
	当所有锁定资金（假如存在的话）释放之后，订单才标记为settled状态

	
	官方文档建议：
	针对委托量大的交易，强烈建议我们自己维护未完成订单列表。1.启动交易时，获取所有订单，2.订阅行情，根据信息进行状态维护
	
#### 查询单个订单 ####
**GET /orders/<order-id>**

key级别：view或trade

	如果订单已经撤单且订单没有任何撮合记录，可能返回404状态码（需要验证真实情况）
	
	响应信息：
	{
	    "id": "68e6a28f-ae28-4788-8d4f-5ab4e5e5ae08",
	    "size": "1.00000000",
	    "product_id": "BTC-USD",
	    "side": "buy",
	    "stp": "dc",
	    "funds": "9.9750623400000000",
	    "specified_funds": "10.0000000000000000",
	    "type": "market",
	    "post_only": false,
	    "created_at": "2016-12-08T20:09:05.508883Z", # 订单创建时间
	    "done_at": "2016-12-08T20:09:05.527Z",  # 订单完成时间
	    "done_reason": "filled",  # 订单完成原因
	    "fill_fees": "0.0249376391550000",  # 交易手续费
	    "filled_size": "0.01291771",  # 撮合量
	    "executed_value": "9.9750556620000000",
	    "status": "done",  # 订单状态
	    "settled": true	   # 是否可变（true 不可变，false 可变）
	}


	warnning:在查询-响应这个过程中，订单状态在市场上可能已经发生变化

#### 获取撮合记录 ####

**GET /fills**

	参数说明
	字段				说明
	order_id		指定订单的撮合记录，默认为all，获取所有订单
	product_id		指定交易对的撮合记录，默认为all，获取所有交易对

	
	返回信息：
	
	[
	    {
	        "trade_id": 74,  # 交易ID
	        "product_id": "BTC-USD",  # 交易对
	        "price": "10.00",	# 交易价格
	        "size": "0.01",	# 交易量
	        "order_id": "d50ec984-77a8-460a-b958-66f114b0de9b", # 订单ID
	        "created_at": "2014-11-07T22:19:28.578544Z",  # 撮合时间
	        "liquidity": "T",  # 角色（T：taker 深度消耗者  M：maker 深度制造者）
	        "fee": "0.00025",	# 单笔手续费
	        "settled": true,	# 是否结算
	        "side": "buy"	# 买卖方向
	    }
	]


===============================================================================================================

## 账户(account) ##

### websocket接口 ###

---
### rest接口 ###

一个账户对应一种币种，比如用户有USD，BTC，ETH，则对应于三个账户

#### 查询账户资金 ####

**GET /accounts**

key级别：view 或 trade

响应信息字段说明：

	id	     		账户ID
	currency		账户币种
	balance			账户资金总额
	holds			锁定资金（不可用）
	available		可用资金

示例：

	[
    {
        "id": "71452118-efc7-4cc4-8780-a5e22d4baa53",
        "currency": "BTC",
        "balance": "0.0000000000000000",
        "available": "0.0000000000000000",
        "hold": "0.0000000000000000",
        "profile_id": "75da88c5-05bf-4f54-bc85-5c775bd68254"
    },
    {
        "id": "e316cb9a-0808-4fd7-8914-97829c1925de",
        "currency": "USD",
        "balance": "80.2301373066930000",
        "available": "79.2266348066930000",
        "hold": "1.0035025000000000",
        "profile_id": "75da88c5-05bf-4f54-bc85-5c775bd68254"
    }
	]

**API说明上，锁定资金为holds，而消息中为hold，此处需要进行验证！！！**

#### 查询单个账户资金 ####
**GET /accounts/<account-id>**

key级别：view 或 trade

响应信息字段说明：

	id	     		账户ID
	balance			账户资金总额
	holds			锁定资金（不可用）
	available		可用资金

示例：

	{
    "id": "a1b2c3d4",
    "balance": "1.100",
    "holds": "0.100",
    "available": "1.00",
    "currency": "USD"
	}

**字段说明中缺失currency字段，需验证！！**

#### 查询账户变动历史 ####
**GET /accounts/<account-id>/ledger**

key级别：view 或 trade


#### 获取账户资金锁定原因及明细 ####
**GET /accounts/<account-id>/holds**

key级别：view 或 trade

===============================================================================================================